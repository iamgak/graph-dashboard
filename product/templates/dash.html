<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }

      nav {
        background-color: #2c3e50;
        color: white;
        padding: 15px;
        text-align: left;
      }

      nav a {
        color: white;
        text-decoration: none;
        margin: 0 15px;
        font-size: 18px;
      }

      .dashboard-header {
        background-color: #2ecc71;
        padding: 30px 0;
        text-align: left;
      }

      .dashboard-header h1 {
        color: white;
      }

      .charts-container {
        display: flex;
        flex-wrap: wrap; /* Allow charts to wrap onto a new line */
        justify-content: space-around;
        padding: 30px;
      }

      .chart {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin: 15px; /* Add margin for spacing between charts */
        width: calc(50% - 30px); /* Calculate 50% width minus margin */
        box-sizing: border-box; /* Include padding and border in width calculation */
      }

      @media (max-width: 768px) {
        .chart {
          width: calc(100% - 30px); /* Full width on smaller screens */
        }
      }
    </style>
    <!-- Add this to the head of your HTML document -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>

  <body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <nav>
      <a href="#"><i class="fas fa-home"></i> Home | Dashboard</a>
    </nav>

    <form method="GET" action="{% url 'dash' %}">
      <label for="search-input">Filters:</label>
      <select name="first" id="first" onchange="send_data()">
        <option value="">Enter Something</option>
        <option value="intensity">intensity</option>
        <option value="sector">sector</option>
        <option value="topic">topic</option>
        <option value="insight">insight</option>
        <option value="region">region</option>
        <option value="relevance">relevance</option>
        <option value="pestle">pestle</option>
        <option value="source">source</option>
        <option value="likelihood">likelihood</option>
      </select>
      <select name="second" id="second">
        <option value="">Enter Something</option>
      </select>
      <button type="submit">Search</button>
    </form>
    <div class="charts-container">
      {% for attribute in attributes %}
      <div class="chart">
        <h2>{{ attribute }}</h2>
        <canvas id="chart{{ forloop.counter }}"></canvas>
      </div>
      {% endfor %}
    </div>
    <script>
            let attributes = [];
            {% for attribute in attributes %}
            attributes.push("{{ attribute }}");
            {% endfor %}
      //   console.log('atttr',attributes )
        let label_data;
        let graph =['pie','bar','line','doughnut','bubble']
        let data = {
                intensity: [],
                likelihood: [],
                pestle: [],
                relevance: [],
                region: [],
                sector: [],
                topic: [],
                country: []
            };

            {% for article in data %}
                data.intensity.push('{{ article.intensity }}');
                data.likelihood.push('{{ article.likelihood }}');
                data.pestle.push('{{ article.pestle }}');
                data.relevance.push('{{ article.relevance }}');
                data.region.push('{{ article.region }}');
                data.sector.push('{{ article.sector }}');
                data.topic.push('{{ article.topic }}');
                data.country.push('{{ article.country }}');
            {% endfor %}

            let backgroundColor =['rgba(75, 192, 192, 0.2)',[
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)'
                    ],'rgba(75, 192, 192, 1)',
                     ['rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    ['rgba(255, 99, 132, 0.2)',
              'rgba(255, 159, 64, 0.2)',
              'rgba(255, 205, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(153, 102, 255, 0.2)',
              'rgba(201, 203, 207, 0.2)'
            ]
          ]

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
            };

            let ctx1;
            let rem;
            let x;
            valid = [16,1,12]
            for (let i = 1;i<= attributes.length;i++){
                
                rem=i%4
                x = attributes[i-1]
                console.log(x,i-1)
                ctx1 = document.getElementById('chart'+i).getContext('2d');
                new Chart(ctx1, {
                    type: graph[rem],
                    data: {
                labels: data['region'],
                datasets: [{
                    label: attributes[i-1],
                    data: data[attributes[valid[(i-1)%3]]] ,
                    backgroundColor: backgroundColor[rem],
                    borderColor: backgroundColor[rem],
                    borderWidth: 1
                }]
            }
        });
        }

        function send_data(){
            let value = $('#first').val();
            console.log(data[value])
            var second_id = document.getElementById("second");
            document.querySelectorAll('option').forEach(opt=>second_id.remove(opt))

            for (var i = 0; i < data[value].length; i++) {
                var option = document.createElement('option');
                option.value = data[value][i]
                option.innerHTML = data[value][i]
                document.getElementById('second').appendChild(option)


            }
                }
    </script>

    <!-- ... (remaining HTML code) ... -->
  </body>
</html>
